<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>项目信息配置</title>
    <link type="text/css" href="scripts/bootstrap/bootstrap.min.css" rel="stylesheet"/>
    <script src="./scripts/boot.js" type="text/javascript"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <h3>项目信息配置<span id="projectName">——海工项目</span></h3>
            <div style="margin-top:25px" id="tabs" class="mini-tabs" activeIndex="0">
                <div name="role" title="项目角色管理">
                    <h3>项目角色</h3>
                    <div class="row">
                        <div class="col-sm-8">
                            <button class="btn btn-info" type="button" onclick="addRow(roleGrid)">添加</button>
                            <button class="btn btn-info" type="button" onclick="deleteRows(roleGrid)">删除</button>
                            <button class="btn btn-info" type="button" onclick="saveRole()">保存</button>
                        </div>
                        <div class="col-sm-4">
                            <span>从项目：</span>
                            <input id="projectCombo1" class="mini-combobox" style="width:150px;" textField="name" valueField="id"
                                   url="scripts/mock/projects.json"/>
                            <button class="btn btn-primary" type="button" onclick="importRole()">导入</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12" style="padding-top: 20px">
                            <div id="roleTable" class="mini-datagrid" style="height: 400px"
                                 url="scripts/mock/roles.json" idField="id"
                                 sizeList="[20,30,50,100]" pageSize="20" allowCellEdit="true"
                                 allowCellSelect="true" multiSelect="true"
                                 editNextOnEnterKey="true" editNextRowCell="true">
                                <div property="columns">
                                    <div type="indexcolumn" width="10"></div>
                                    <div type="checkcolumn" width="10"></div>
                                    <div name="code" field="code" headerAlign="center" allowSort="true">角色编码
                                        <input property="editor" class="mini-textbox" style="width:100%;"/>
                                    </div>
                                    <div name="description" field="description" headerAlign="center">角色描述
                                        <input property="editor" class="mini-textarea" style="width:100%;"
                                               minHeight="50"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div title="项目业务组管理">
                    <h3>业务组信息</h3>
                    <div class="row">
                        <div class="col-sm-8">
                            <button class="btn btn-info" type="button" onclick="addRow(groupGrid)">添加</button>
                            <button class="btn btn-info" type="button" onclick="deleteRows(groupGrid)">删除</button>
                            <button class="btn btn-info" type="button" onclick="saveGroup()">保存</button>
                        </div>
                        <div class="col-sm-4">
                            <span>从项目：</span>
                            <input id="projectCombo2" class="mini-combobox" style="width:150px;" textField="name" valueField="id"
                                   url="scripts/mock/projects.json"/>
                            <button class="btn btn-primary" type="button" onclick="importGroup()">导入</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12" style="padding-top: 20px">
                            <div id="groupTable" class="mini-datagrid" style="height: 400px"
                                 url="scripts/mock/groups.json" idField="id"
                                 sizeList="[20,30,50,100]" pageSize="20" allowCellEdit="true"
                                 allowCellSelect="true" multiSelect="true"
                                 editNextOnEnterKey="true" editNextRowCell="true">
                                <div property="columns">
                                    <div type="indexcolumn" width="10"></div>
                                    <div type="checkcolumn" width="10"></div>
                                    <div name="code" field="code" headerAlign="center" allowSort="true">业务组编码
                                        <input property="editor" class="mini-textbox" style="width:100%;"/>
                                    </div>
                                    <div name="description" field="description" headerAlign="center">业务组描述
                                        <input property="editor" class="mini-textbox" style="width:100%;" />
                                    </div>
                                    <div type="checkboxcolumn" field="majorFlag" trueValue="1" falseValue="0" width="60" headerAlign="center">是否分专业</div>
                                    <div name="action" width="120" headerAlign="center" align="center" renderer="onGroupActionRenderer"
                                         cellStyle="padding:0;">操作
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div name="file" title="文件类型">
                    <h3>文件类型</h3>
                    <div class="row">
                        <div class="col-sm-8">
                            <button class="btn btn-info" type="button" onclick="addRow(fileGrid)">添加</button>
                            <button class="btn btn-info" type="button" onclick="deleteRows(fileGrid)">删除</button>
                            <button class="btn btn-info" type="button" onclick="saveFile()">保存</button>
                        </div>
                        <div class="col-sm-4">
                            <span>从项目：</span>
                            <input id="projectCombo3" class="mini-combobox" style="width:150px;" textField="name" valueField="id"
                                   url="scripts/mock/projects.json"/>
                            <button class="btn btn-primary" type="button" onclick="importFile()">导入</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12" style="padding-top: 20px">
                            <div id="fileTable" class="mini-datagrid" style="height: 400px"
                                 url="scripts/mock/files.json" idField="id"
                                 sizeList="[20,30,50,100]" pageSize="20" allowCellEdit="true"
                                 allowCellSelect="true" multiSelect="true"
                                 editNextOnEnterKey="true" editNextRowCell="true">
                                <div property="columns">
                                    <div type="indexcolumn" width="10"></div>
                                    <div type="checkcolumn" width="10"></div>
                                    <div name="code" field="code" headerAlign="center" allowSort="true">文件类型编号
                                        <input property="editor" class="mini-textbox" style="width:100%;"/>
                                    </div>
                                    <div name="description" field="description" headerAlign="center">文件类型描述
                                        <input property="editor" class="mini-textarea" style="width:100%;" minHeight="50"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div name="host" title="承办类型定义">
                    <h3>承办类型</h3>
                    <div class="row">
                        <div class="col-sm-8">
                            <button class="btn btn-info" type="button" onclick="addRow(hostGrid)">添加</button>
                            <button class="btn btn-info" type="button" onclick="deleteRows(hostGrid)">删除</button>
                            <button class="btn btn-info" type="button" onclick="saveHost()">保存</button>
                        </div>
                        <div class="col-sm-4">
                            <span>从项目：</span>
                            <input id="projectCombo4" class="mini-combobox" style="width:150px;" textField="name" valueField="id"
                                   url="scripts/mock/projects.json"/>
                            <button class="btn btn-primary" type="button" onclick="importHost()">导入</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12" style="padding-top: 20px">
                            <div id="hostTable" class="mini-datagrid" style="height: 400px"
                                 url="scripts/mock/hosts.json" idField="id"
                                 sizeList="[20,30,50,100]" pageSize="20" allowCellEdit="true"
                                 allowCellSelect="true" multiSelect="true"
                                 editNextOnEnterKey="true" editNextRowCell="true">
                                <div property="columns">
                                    <div type="indexcolumn" width="10"></div>
                                    <div type="checkcolumn" width="10"></div>
                                    <div name="code" field="code" headerAlign="center" allowSort="true">承办类别编码
                                        <input property="editor" class="mini-textbox" style="width:100%;"/>
                                    </div>
                                    <div type="comboboxcolumn" autoShowPopup="true" name="type" field="type"
                                         allowSort="true"  align="center" headerAlign="center">承办类别描述
                                        <input property="editor" class="mini-combobox" style="width:100%;" data="types" />
                                    </div>
                                    <div type="checkboxcolumn" field="replyFlag" trueValue="1" falseValue="0" width="60" headerAlign="center">是否可撰写回复</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="scripts/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="scripts/miniui/miniui.js"></script>
<script type="text/javascript">
    var types = [{ id: 1, text: '主办' }, { id: 2, text: '协办'}, {id: 3, text: '阅知'}];

    mini.parse();
    //选择项目
    var projectCombo1 = mini.get("projectCombo1"); //角色
    var projectCombo2 = mini.get("projectCombo2"); //业务组
    var projectCombo3 = mini.get("projectCombo3"); //业务组
    var projectCombo4 = mini.get("projectCombo4"); //承办类型

    //项目角色管理
    var roleGrid = mini.get("roleTable");
    //业务组管理
    var groupGrid = mini.get("groupTable");
    //文件类型
    var fileGrid = mini.get("fileTable");
    //承办类别定义的表格
    var hostGrid = mini.get("hostTable");

    //标签页
    var tabs = mini.get("tabs");

    //common
    function deleteRows(grid){
        var rows = grid.getSelecteds();
        if (rows.length > 0) {
            grid.removeRows(rows, false);
        }
    }
    function addRow(grid){
        var newRow = {code:""};
        grid.addRow(newRow, 0);

        grid.beginEditCell(newRow, "code");
    }
    function celleditenter(grid){
        var index = grid.indexOf(e.record);
        if (index == grid.getData().length - 1) {
            var row = {};
            grid.addRow(row);
        }
    }
    function beforeload(e,grid){
        if (grid.getChanges().length > 0) {
            if (confirm("有增删改的数据未保存，是否取消本次操作？")) {
                e.cancel = true;
            }
        }
    }
    //角色
    roleGrid.load();
    function importRole() {
        console.log(projectCombo1.getValue());
    }
    function saveRole() {
        var data = roleGrid.getChanges();
        var json = mini.encode(data);
//        grid.loading("保存中，请稍后......");
        console.log(json);
    }
    roleGrid.on("celleditenter", function (e) {
        celleditenter(roleGrid);
    });
    roleGrid.on("beforeload", function (e) {
        beforeload(e, roleGrid);
    });

    //业务组
    groupGrid.load();
    function majorManage(id) {
//        弹出框
        mini.open({
            url: "./frame/major.html",
            title: "专业信息", width: 400, height: 360,
            onload: function () {
                var iframe = this.getIFrameEl();
                var data = { id: id};
                iframe.contentWindow.SetData(data);
            },
            ondestroy: function (action) {
            }
        });
    }
    function onGroupActionRenderer(e) {
        var record = e.record;
        var id = record.id;

        var s = '<a href="javascript:majorManage(' + id + ')">专业信息管理</a> ';
        if(record.majorFlag==0)
            s='';
        return s;
    }
    function importGroup() {
        console.log(projectCombo2.getValue());
    }
    function saveGroup() {
        var data = groupGrid.getChanges();
        var json = mini.encode(data);
//        grid.loading("保存中，请稍后......");
        console.log(json);
//        $.ajax({
//            url: url,
//            data: { data: json },
//            type: "post",
//            success: function (text) {
//                grid.reload();
//            },
//            error: function (jqXHR, textStatus, errorThrown) {
//                alert(jqXHR.responseText);
//            }
//        });
    }
    groupGrid.on("celleditenter", function (e) {
        celleditenter(groupGrid);
    });
    groupGrid.on("beforeload", function (e) {
        beforeload(e, groupGrid);
    });
    //文件类型
    fileGrid.load();
    function importFile() {
        console.log(projectCombo3.getValue());
    }
    function saveFile() {
        var data = fileGrid.getChanges();
        var json = mini.encode(data);

        console.log(json);
    }
    fileGrid.on("celleditenter", function (e) {
        celleditenter(fileGrid);
    });
    fileGrid.on("beforeload", function (e) {
        beforeload(e, fileGrid);
    });

    //承办类型
    hostGrid.load();
    function importHost() {
        console.log(projectCombo4.getValue());
    }
    function saveHost() {
        var data = hostGrid.getChanges();
        var json = mini.encode(data);

        console.log(json);
    }
    hostGrid.on("celleditenter", function (e) {
        celleditenter(hostGrid);
    });
    hostGrid.on("beforeload", function (e) {
        beforeload(e, hostGrid);
    });

</script>
</body>
</html>
