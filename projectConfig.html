<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>项目信息配置</title>
    <link type="text/css" href="scripts/bootstrap/bootstrap.min.css" rel="stylesheet"/>
    <script src="./scripts/boot.js" type="text/javascript"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <h3>项目信息配置<span id="projectName">——海工项目</span></h3>
            <div style="margin-top:25px" id="tabs" class="mini-tabs" activeIndex="0">
                <div name="role" title="项目角色管理">
                    <h3>项目角色</h3>
                    <div class="row">
                        <div class="col-sm-8">
                            <button class="btn btn-info" type="button" onclick="addRole()">添加</button>
                            <button class="btn btn-info" type="button" onclick="deleteRole()">删除</button>
                            <button class="btn btn-info" type="button" onclick="saveRole()">保存</button>
                        </div>
                        <div class="col-sm-4">
                            <span>从项目：</span>
                            <input id="projectCombo1" class="mini-combobox" style="width:150px;" textField="name" valueField="id"
                                   url="scripts/mock/projects.json"/>
                            <button class="btn btn-primary" type="button" onclick="importRole()">导入</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12" style="padding-top: 20px">
                            <div id="roleTable" class="mini-datagrid"
                                 url="scripts/mock/roles.json" idField="id" allowResize="true"
                                 sizeList="[20,30,50,100]" pageSize="20" allowCellEdit="true"
                                 allowCellSelect="true" multiSelect="true"
                                 editNextOnEnterKey="true" editNextRowCell="true">
                                <div property="columns">
                                    <div type="indexcolumn"></div>
                                    <div type="checkcolumn"></div>
                                    <div name="code" field="code" width="120" headerAlign="center" allowSort="true">角色编码
                                        <input property="editor" class="mini-textbox" style="width:100%;"/>
                                    </div>
                                    <div name="description" field="description" width="120" headerAlign="center">角色描述
                                        <input property="editor" class="mini-textarea" style="width:100%;"
                                               minHeight="50"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div title="项目业务组管理">
                    <h3>业务组信息</h3>
                    <div class="row">
                        <div class="col-sm-8">
                            <button class="btn btn-info" type="button" onclick="addGroup()">添加</button>
                            <button class="btn btn-info" type="button" onclick="deleteGroup()">删除</button>
                            <button class="btn btn-info" type="button" onclick="saveGroup()">保存</button>
                        </div>
                        <div class="col-sm-4">
                            <span>从项目：</span>
                            <input id="projectCombo2" class="mini-combobox" style="width:150px;" textField="name" valueField="id"
                                   url="scripts/mock/projects.json"/>
                            <button class="btn btn-primary" type="button" onclick="importHost()">导入</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12" style="padding-top: 20px">
                            <div id="groupTable" class="mini-datagrid"
                                 url="scripts/mock/hosts.json" idField="id" allowResize="true"
                                 sizeList="[20,30,50,100]" pageSize="20" allowCellEdit="true"
                                 allowCellSelect="true" multiSelect="true"
                                 editNextOnEnterKey="true" editNextRowCell="true">
                                <div property="columns">
                                    <div type="indexcolumn"></div>
                                    <div name="code" field="code" width="120" headerAlign="center" allowSort="true">业务组编码
                                        <input property="editor" class="mini-textbox" style="width:100%;"/>
                                    </div>
                                    <div type="comboboxcolumn" autoShowPopup="true" name="type" field="type"
                                         width="120" allowSort="true"  align="center" headerAlign="center">业务组描述
                                        <input property="editor" class="mini-combobox" style="width:100%;" data="types" />
                                    </div>

                                    <div name="action" width="120" headerAlign="center" align="center" renderer="onActionRenderer"
                                         cellStyle="padding:0;">操作
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div title="文件类型">
                    3
                </div>
                <div name="host" title="承办类型定义">
                    <h3>承办类型</h3>
                    <div class="row">
                        <div class="col-sm-8">
                            <button class="btn btn-info" type="button" onclick="addHost()">添加</button>
                            <button class="btn btn-info" type="button" onclick="deleteHost()">删除</button>
                            <button class="btn btn-info" type="button" onclick="saveHost()">保存</button>
                        </div>
                        <div class="col-sm-4">
                            <span>从项目：</span>
                            <input id="projectCombo4" class="mini-combobox" style="width:150px;" textField="name" valueField="id"
                                   url="scripts/mock/projects.json"/>
                            <button class="btn btn-primary" type="button" onclick="importHost()">导入</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12" style="padding-top: 20px">
                            <div id="hostTable" class="mini-datagrid"
                                 url="scripts/mock/hosts.json" idField="id" allowResize="true"
                                 sizeList="[20,30,50,100]" pageSize="20" allowCellEdit="true"
                                 allowCellSelect="true" multiSelect="true"
                                 editNextOnEnterKey="true" editNextRowCell="true">
                                <div property="columns">
                                    <div type="indexcolumn"></div>
                                    <div name="code" field="code" width="120" headerAlign="center" allowSort="true">承办类别编码
                                        <input property="editor" class="mini-textbox" style="width:100%;"/>
                                    </div>
                                    <div type="comboboxcolumn" autoShowPopup="true" name="type" field="type"
                                         width="120" allowSort="true"  align="center" headerAlign="center">承办类别描述
                                        <input property="editor" class="mini-combobox" style="width:100%;" data="types" />
                                    </div>
                                    <div type="checkboxcolumn" field="replyFlag" trueValue="1" falseValue="0" width="60" headerAlign="center">是否可撰写回复</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="scripts/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="scripts/miniui/miniui.js"></script>
<script type="text/javascript">
    var types = [{ id: 1, text: '主办' }, { id: 2, text: '协办'}, {id: 3, text: '阅知'}];

    mini.parse();
    //选择项目
    var projectCombo1 = mini.get("projectCombo1"); //角色
    var projectCombo2 = mini.get("projectCombo2"); //业务组
    var projectCombo4 = mini.get("projectCombo4"); //承办类型

    //项目角色管理
    var roleGrid = mini.get("roleTable");
    //业务组管理
    var groupGrid = mini.get("groupTable");
    //承办类别定义的表格
    var hostGrid = mini.get("hostTable");

    //标签页
    var tabs = mini.get("tabs");

    //角色
    roleGrid.load();
    function importRole() {
        console.log('import');
    }
    function deleteRole() {
        var rows = roleGrid.getSelecteds();
        if (rows.length > 0) {
            roleGrid.removeRows(rows, false);
        }
    }
    function addRole() {
//        弹出框
//        mini.open({
//            url: "./frame/project.html",
//            title: "新增项目", width: 240, height: 200,
//            onload: function () {
//                var iframe = this.getIFrameEl();
//                var data = { action: "new"};
//                iframe.contentWindow.SetData(data);
//            },
//            ondestroy: function (action) {
//                grid.reload();
//            }
//        });
//        直接添加空白行
        var newRow = {name: ""};
        roleGrid.addRow(newRow, 0);

        roleGrid.beginEditCell(newRow, "name");
    }
    function saveRole() {
        var data = roleGrid.getChanges();
        var json = mini.encode(data);

//        grid.loading("保存中，请稍后......");
        console.log(json);
//        $.ajax({
//            url: "../data/AjaxService.aspx?method=SaveEmployees",
//            data: { data: json },
//            type: "post",
//            success: function (text) {
//                grid.reload();
//            },
//            error: function (jqXHR, textStatus, errorThrown) {
//                alert(jqXHR.responseText);
//            }
//        });
    }
    roleGrid.on("celleditenter", function (e) {
        var index = roleGrid.indexOf(e.record);
        if (index == roleGrid.getData().length - 1) {
            var row = {};
            roleGrid.addRow(row);
        }
    });
    roleGrid.on("beforeload", function (e) {
        if (roleGrid.getChanges().length > 0) {
            if (confirm("有增删改的数据未保存，是否取消本次操作？")) {
                e.cancel = true;
            }
        }
    });

    //业务组
    groupGrid.load();
    function importGroup() {
        console.log('import');
    }
    function deleteGroup() {
        var rows = roleGrid.getSelecteds();
        if (rows.length > 0) {
            roleGrid.removeRows(rows, false);
        }
    }
    function addGroup() {
//        弹出框
//        mini.open({
//            url: "./frame/project.html",
//            title: "新增项目", width: 240, height: 200,
//            onload: function () {
//                var iframe = this.getIFrameEl();
//                var data = { action: "new"};
//                iframe.contentWindow.SetData(data);
//            },
//            ondestroy: function (action) {
//                grid.reload();
//            }
//        });
//        直接添加空白行
        var newRow = {name: ""};
        groupGrid.addRow(newRow, 0);

        groupGrid.beginEditCell(newRow, "name");
    }
    function saveGroup() {
        var data = groupGrid.getChanges();
        var json = mini.encode(data);

//        grid.loading("保存中，请稍后......");
        console.log(json);
//        $.ajax({
//            url: "../data/AjaxService.aspx?method=SaveEmployees",
//            data: { data: json },
//            type: "post",
//            success: function (text) {
//                grid.reload();
//            },
//            error: function (jqXHR, textStatus, errorThrown) {
//                alert(jqXHR.responseText);
//            }
//        });
    }
    groupGrid.on("celleditenter", function (e) {
        var index = groupGrid.indexOf(e.record);
        if (index == groupGrid.getData().length - 1) {
            var row = {};
            groupGrid.addRow(row);
        }
    });
    groupGrid.on("beforeload", function (e) {
        if (groupGrid.getChanges().length > 0) {
            if (confirm("有增删改的数据未保存，是否取消本次操作？")) {
                e.cancel = true;
            }
        }
    });

    //承办类型
    hostGrid.load();
    function importHost() {
        console.log('import');
    }
    function deleteHost() {
        var rows = hostGrid.getSelecteds();
        if (rows.length > 0) {
            hostGrid.removeRows(rows, false);
        }
    }
    function addHost() {
//        弹出框
//        mini.open({
//            url: "./frame/project.html",
//            title: "新增项目", width: 240, height: 200,
//            onload: function () {
//                var iframe = this.getIFrameEl();
//                var data = { action: "new"};
//                iframe.contentWindow.SetData(data);
//            },
//            ondestroy: function (action) {
//                grid.reload();
//            }
//        });
//        直接添加空白行
        var newRow = {name: ""};
        hostGrid.addRow(newRow, 0);
        hostGrid.beginEditCell(newRow, "name");
    }
    function saveHost() {
        var data = hostGrid.getChanges();
        var json = mini.encode(data);

//        grid.loading("保存中，请稍后......");
        console.log(json);
//        $.ajax({
//            url: "../data/AjaxService.aspx?method=SaveEmployees",
//            data: { data: json },
//            type: "post",
//            success: function (text) {
//                grid.reload();
//            },
//            error: function (jqXHR, textStatus, errorThrown) {
//                alert(jqXHR.responseText);
//            }
//        });
    }
    hostGrid.on("celleditenter", function (e) {
        var index = hostGrid.indexOf(e.record);
        if (index == hostGrid.getData().length - 1) {
            var row = {};
            hostGrid.addRow(row);
        }
    });
    hostGrid.on("beforeload", function (e) {
        if (hostGrid.getChanges().length > 0) {
            if (confirm("有增删改的数据未保存，是否取消本次操作？")) {
                e.cancel = true;
            }
        }
    });

</script>
</body>
</html>
